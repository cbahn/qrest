{% extends "loc_layout.jinja2" %}

{% block content %}
<!-- Main Content -->
<main class="container">
    <section id="home">
        <h1>{{ loc.fullName }}</h1>
        <img src="{{ url_for('static',filename='uploads/' + loc.imageFile) }}">
        
    </section>
    <section id="details">
        <p>{{ loc.description}} </p>
        <article>
            <header>Puzzle</header>
            {{ loc.puzzleText }}
            <footer>
                <form id="puzzle-form">
                    <fieldset role="group">
                    <input
                      type="text"
                      name="guess"
                      placeholder="Enter your guess..."
                      required
                    />
                    <input 
                      type="hidden"
                      name ="slug"
                      value="{{ loc.slug }}" />
                    <input type="submit" value="Submit" />
                    </fieldset>
                </form>
            </footer>
        </article>
        <article>
        <header>Feedback on Puzzle Answer</header>
        <div id="feedback" aria-live="polite">-</div>
        </article>
    </section>
</main>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('puzzle-form');
  const feedbackEl = document.getElementById('feedback');

  form.addEventListener('submit', function (event) {
    event.preventDefault();

    // Gather the form data.
    const formData = new FormData(form);

    // Send a POST request to the server.
    fetch('{{ url_for("location_bp_x.validate_guess") }}', {
      method: 'POST',
      body: formData,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error("Network response was not ok");
      }
      return response.json();
    })
    .then(data => {
      // Expecting the JSON response to include a key like "correct"
      if (data.correct) {
        feedbackEl.textContent = "Correct!";
        feedbackEl.style.color = "green";
      } else {
        feedbackEl.textContent = "Wrong answer. Try again.";
        feedbackEl.style.color = "red";
      }
    })
    .catch(error => {
      console.error("Error:", error);
      feedbackEl.textContent = "There was an error processing your request.";
      feedbackEl.style.color = "red";
    });
  });
});
</script>
{% endblock %}